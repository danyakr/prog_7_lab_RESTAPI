# Лабораторная работа - Разработка REST API и работа с OpenAPI

---

## 1. Цель работы

Изучение принципов разработки RESTful API с использованием фреймворка FastAPI, автоматической генерации документации OpenAPI и тестирования API с помощью Swagger UI.

---

## 2. Теоретическая часть

### 2.1. REST API

**REST (Representational State Transfer)** — архитектурный стиль для создания веб-сервисов, определяющий набор ограничений для взаимодействия между компьютерными системами в интернете.

#### Шесть принципов REST:

1. **Единообразный интерфейс (Uniform Interface)** — стандартизированные методы взаимодействия с ресурсами
2. **Клиент-сервер (Client-Server)** — разделение ответственности между клиентом и сервером
3. **Отсутствие состояния (Stateless)** — каждый запрос содержит всю необходимую информацию
4. **Кэшируемый (Cacheable)** — возможность кэширования ответов
5. **Слоистая система (Layered System)** — иерархическая архитектура
6. **Код по требованию (Code on Demand)** — опциональная загрузка кода на клиент

### 2.2. OpenAPI

**OpenAPI Specification (OAS)** — стандартный, не зависящий от языка интерфейс для описания RESTful API. Позволяет автоматически генерировать документацию и клиентский код.

**Swagger** — набор инструментов с открытым исходным кодом для работы с OpenAPI спецификацией.

### 2.3. FastAPI

**FastAPI** — современный высокопроизводительный веб-фреймворк для создания API на Python 3.7+.

**Ключевые особенности:**
- Высокая производительность (наравне с NodeJS и Go)
- Автоматическая генерация интерактивной документации
- Встроенная валидация данных через Pydantic
- Поддержка асинхронного программирования
- Соответствие стандартам OpenAPI и JSON Schema

---

## 3. Практическая часть

### 3.1. Установка зависимостей

```bash
pip install fastapi uvicorn[standard] pydantic
```

### 3.2. Создание базового REST API

Создан файл `main.py` с реализацией REST API для управления библиотекой книг.

**Основные компоненты:**
- Модели данных (Book, BookUpdate) на основе Pydantic
- CRUD операции для работы с книгами
- Валидация входных данных
- Обработка ошибок с соответствующими HTTP кодами

**Запуск приложения:**
```bash
uvicorn main:app --reload
```

**Доступные endpoints:**
- `http://localhost:8000` — корневой эндпоинт
- `http://localhost:8000/docs` — Swagger UI
- `http://localhost:8000/redoc` — ReDoc документация
- `http://localhost:8000/openapi.json` — OpenAPI спецификация

---

## 4. Тестирование API

### 4.1. Чтение (Read) всей коллекции

**Метод:** `GET /api/books`

**Результат:** Получен список всех книг с кодом состояния 200 OK

![Чтение коллекции](https://github.com/user-attachments/assets/9b7ef5a4-fd3b-4822-9bf2-3b5404f691eb)

---

### 4.2. Создание (Create) нового ресурса

**Метод:** `POST /api/books`

#### Успешное создание

**Тестовые данные:**
```json
{
  "title": "Анна Каренина",
  "author": "Лев Толстой",
  "year": 1877,
  "isbn": "9785170654321"
}
```

**Результат:** Книга успешно создана, присвоен ID 4, код состояния 201 Created

![Успешное создание](https://github.com/user-attachments/assets/e990d6e4-d5e9-49f9-8db7-66f0c2ba86fe)

#### Проверка валидации

**Тестовые данные с ошибкой:**
```json
{
  "title": "Тест",
  "author": "Автор",
  "year": 3000
}
```

**Результат:** Получена ошибка валидации 422 Unprocessable Entity — год превышает допустимое значение

![Ошибка валидации](https://github.com/user-attachments/assets/feb285db-4653-4451-95da-13dc34b758a6)

---

### 4.3. Обновление (Update) ресурса

#### Полное обновление

**Метод:** `PUT /api/books/{book_id}`

**Результат:** Все данные книги полностью заменены новыми значениями

![PUT обновление](https://github.com/user-attachments/assets/146edd60-d4bc-4fe1-94a4-0e2784935da0)

#### Частичное обновление

**Метод:** `PATCH /api/books/{book_id}`

**Результат:** Обновлены только указанные поля, остальные данные сохранены

![PATCH обновление](https://github.com/user-attachments/assets/8468035b-53b0-4d37-8616-f5831513c43d)

---

### 4.4. Удаление (Delete) ресурса

**Метод:** `DELETE /api/books/{book_id}`

**Результат:** Книга успешно удалена, код состояния 204 No Content

![Удаление](https://github.com/user-attachments/assets/4d096b6b-54f1-4afd-85b2-443a6367b38b)

---

## 5. Изучение OpenAPI спецификации

Автоматически сгенерированная OpenAPI спецификация доступна по адресу `http://localhost:8000/openapi.json`

**Основные компоненты спецификации:**
- **info** — метаданные API (название, версия, описание)
- **paths** — описание всех эндпоинтов с параметрами и схемами
- **components/schemas** — схемы данных (Book, BookUpdate, ValidationError)

![OpenAPI спецификация](https://github.com/user-attachments/assets/43d61e13-fda5-440c-b424-6a2c48b1c6b0)

---

## 6. Расширение функциональности API

### 6.1. Добавление фильтрации

Модифицирована функция `get_books` для поддержки параметров фильтрации по автору и году издания.

**Новые параметры:**
- `author` — фильтр по автору (частичное совпадение)
- `year_from` — минимальный год издания
- `year_to` — максимальный год издания

![Фильтрация](https://github.com/user-attachments/assets/576061e6-ac2c-49e2-b18e-ae26af221115)

#### Тестирование фильтрации

**Запрос:** `GET /api/books?author=толстой`

**Результат:** Возвращены только книги Льва Толстого

![Фильтр по автору](https://github.com/user-attachments/assets/85146eb4-724c-4702-b63c-e7f89ba494e7)

**Запрос:** `GET /api/books?year_from=1860&year_to=1870`

**Результат:** Возвращены книги, изданные в период 1860-1870 годов

![Фильтр по году](https://github.com/user-attachments/assets/8456377d-2912-42f4-abfb-4b9eaf496941)

---

### 6.2. Добавление пагинации

Добавлены параметры пагинации для управления объемом возвращаемых данных.

**Новые параметры:**
- `skip` — количество элементов для пропуска (offset)
- `limit` — максимальное количество элементов в ответе

![Пагинация](https://github.com/user-attachments/assets/93d45358-ef85-46b4-9757-845034f29d40)

#### Тестирование пагинации

**Запрос:** `GET /api/books?skip=1&limit=2`

**Результат:** Пропущена первая книга, возвращены следующие две

![Пагинация тест 1](https://github.com/user-attachments/assets/04e4c70c-b8b4-4049-a5bd-c540a6a6e3f8)

**Запрос:** `GET /api/books?author=толстой&limit=1`

**Результат:** Возвращена только первая книга Толстого

![Пагинация тест 2](https://github.com/user-attachments/assets/00416fc3-4653-47d0-bdac-c614cf82f5b4)

---

### 6.3. Добавление статистики

Создан новый эндпоинт для получения статистической информации о библиотеке.

**Эндпоинт:** `GET /api/books/stats`

**Возвращаемые данные:**
- Общее количество книг
- Распределение книг по авторам
- Распределение книг по векам

![Статистика код](https://github.com/user-attachments/assets/d132d339-c27c-4e44-9e23-d222777e19f7)

**Результат запроса:**

![Статистика результат](https://github.com/user-attachments/assets/05ab15e1-9da6-49ca-9e7a-7a301f00189f)

---

## 7. Интеграция с базой данных SQLite

### 7.1. Цель

Замена временного хранилища в памяти на постоянную базу данных SQLite для обеспечения персистентности данных.

### 7.2. Реализация

**Создан файл `database.py`:**
- Настройка подключения к SQLite
- Определение ORM-модели `BookDB` с использованием SQLAlchemy
- Автоматическое создание таблицы `books`
- Механизм получения сессии базы данных

**Модификация `main.py`:**
- Все CRUD операции переведены на работу с базой данных
- Использование механизма внедрения зависимостей (`Depends(get_db)`)
- Автоматическое управление сессиями и транзакциями

### 7.3. Результат

API переведено на промышленное хранение данных. Данные теперь сохраняются между перезапусками приложения.

---

## 8. Добавление аутентификации

### 8.1. Реализация

Внедрена простая аутентификация на основе API-ключей.

**Создан файл `auth.py`:**
- Определен секретный API-ключ
- Реализована функция проверки ключа `verify_api_key`
- Использование заголовка `X-API-Key`

**Защищенные операции:**
- POST (создание)
- PUT (полное обновление)
- PATCH (частичное обновление)
- DELETE (удаление)

**Публичные операции:**
- GET (чтение) — доступно без аутентификации

### 8.2. Тестирование аутентификации

#### Публичный доступ (GET)

**Запрос:** `GET /api/books` без API-ключа

**Результат:** Успешный доступ, код 200 OK

![GET без ключа](https://github.com/user-attachments/assets/db972f01-8e6a-4510-ae93-442d510e195a)

#### Защищенный доступ без ключа

**Запрос:** `POST /api/books` без API-ключа

**Результат:** Ошибка доступа 403 Forbidden

![POST без ключа](https://github.com/user-attachments/assets/f7e54d77-e44d-4d03-9ebb-1b7ce3701a6a)

#### Защищенный доступ с ключом

**Запрос:** `POST /api/books` с заголовком `X-API-Key: secret-api-key-12345`

**Результат:** Успешное создание ресурса

![Авторизация](https://github.com/user-attachments/assets/c9655d59-c48e-4dfd-b157-3939c202317a)

![POST с ключом](https://github.com/user-attachments/assets/cd0fdbf7-20ba-41aa-af00-35d547dedeb8)

---

## 9. Ответы на контрольные вопросы

1. **Что такое REST и какие шесть принципов лежат в его основе?**
   
   REST — архитектурный стиль для веб-сервисов. Шесть принципов: единообразный интерфейс, клиент-сервер, отсутствие состояния, кэшируемость, слоистая система, код по требованию.

2. **В чем разница между методами PUT и PATCH?**
   
   PUT выполняет полное обновление ресурса (заменяет все данные), PATCH — частичное обновление (изменяет только указанные поля).

3. **Что означает идемпотентность HTTP метода?**
   
   Многократное выполнение операции приводит к одному результату. Идемпотентные: GET, PUT, PATCH, DELETE. Неидемпотентный: POST.

4. **Какие коды состояния HTTP используются?**
   
   - Успех: 2xx (200 OK, 201 Created, 204 No Content)
   - Ошибки клиента: 4xx (400 Bad Request, 401 Unauthorized, 403 Forbidden, 404 Not Found, 422 Unprocessable Entity)
   - Ошибки сервера: 5xx (500 Internal Server Error, 503 Service Unavailable)

5. **Что такое OpenAPI Specification?**
   
   Стандарт для описания REST API в машиночитаемом формате, позволяющий автоматически генерировать документацию и клиентский код.

6. **В чем разница между OpenAPI и Swagger?**
   
   OpenAPI — спецификация (стандарт), Swagger — набор инструментов для работы с OpenAPI.

7. **Преимущества FastAPI:**
   
   Высокая производительность, автоматическая документация, встроенная валидация, простота использования, соответствие стандартам.

8. **Что такое Pydantic?**
   
   Библиотека для валидации данных и управления настройками с использованием Python type hints.

9. **Как FastAPI генерирует документацию?**
   
   Автоматически на основе аннотаций типов, Pydantic моделей и метаданных эндпоинтов.

10. **Важность валидации данных:**
    
    Обеспечивает корректность входных данных, предотвращает ошибки, повышает безопасность и надежность API.

11. **Принцип stateless:**
    
    Каждый запрос содержит всю необходимую информацию, сервер не хранит состояние клиента между запросами.

12. **Компоненты OpenAPI документа:**
    
    openapi (версия), info (метаданные), servers (серверы), paths (эндпоинты), components (переиспользуемые схемы), security (безопасность), tags (группировка).

13. **Обработка ошибок в FastAPI:**
    
    Использование HTTPException с указанием кода состояния и детального описания ошибки.

14. **Что такое HATEOAS?**
    
    Hypermedia as the Engine of Application State — принцип, при котором клиент взаимодействует с приложением через гиперссылки, предоставляемые сервером.

15. **Методы аутентификации в REST API:**
    
    API ключи, Bearer токены (JWT), OAuth2, Basic Auth, Session-based аутентификация.

---

## 10. Выводы

В ходе выполнения лабораторной работы были изучены и практически применены:

1. **Основы REST архитектуры** — понимание принципов построения RESTful сервисов
2. **Фреймворк FastAPI** — создание современных высокопроизводительных API
3. **Валидация данных** — использование Pydantic для обеспечения корректности данных
4. **OpenAPI спецификация** — автоматическая генерация документации
5. **CRUD операции** — реализация полного набора операций над ресурсами
6. **Расширенные возможности** — фильтрация, пагинация, статистика
7. **Работа с базой данных** — интеграция SQLite через SQLAlchemy
8. **Безопасность** — базовая аутентификация с использованием API-ключей

### Приобретенные навыки:

- Проектирование и разработка REST API
- Тестирование API через Swagger UI
- Работа с базами данных в контексте веб-сервисов
- Реализация механизмов безопасности
- Документирование API согласно стандартам OpenAPI

Полученные знания являются фундаментальными для разработки современных веб-приложений и микросервисной архитектуры.

---

## Приложение: Структура проекта

```
project/
├── main.py           # Основной файл приложения с эндпоинтами
├── database.py       # Конфигурация базы данных и ORM модели
├── auth.py           # Модуль аутентификации
├── books.db          # База данных SQLite
└── requirements.txt  # Зависимости проекта
```

### requirements.txt
```
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
sqlalchemy==2.0.23
```

---

**Дата выполнения:** 2025

**Статус:** Работа выполнена полностью, все задания реализованы и протестированы








# Лабораторная работа - Разработка REST API и работа с OpenAPI
pip install fastapi uvicorn[standard] pydantic

Создание файла main.py

uvicorn main:app --reload

<img width="1898" height="964" alt="image" src="https://github.com/user-attachments/assets/9893b724-39c1-4a59-a831-65b12a058197" />

<img width="1903" height="963" alt="image" src="https://github.com/user-attachments/assets/279acb42-ce4b-4a71-bcf8-beb9076091a6" />

Чтение (Read) всей коллекции
GET /api/books
<img width="1798" height="907" alt="image" src="https://github.com/user-attachments/assets/9b7ef5a4-fd3b-4822-9bf2-3b5404f691eb" />

Создание (Create) нового ресурса
POST /api/books
Успешное создание (Проверка кода 201)
<img width="1778" height="824" alt="image" src="https://github.com/user-attachments/assets/e990d6e4-d5e9-49f9-8db7-66f0c2ba86fe" />

Проверка валидации (Проверка кода 422)
<img width="1779" height="911" alt="image" src="https://github.com/user-attachments/assets/feb285db-4653-4451-95da-13dc34b758a6" />

Обновление (Update) ресурса по ID (PUT и PATCH)
Полное обновление (PUT /api/books/{book_id})
<img width="1783" height="825" alt="image" src="https://github.com/user-attachments/assets/146edd60-d4bc-4fe1-94a4-0e2784935da0" />


Частичное обновление (PATCH /api/books/{book_id})
<img width="1773" height="773" alt="image" src="https://github.com/user-attachments/assets/8468035b-53b0-4d37-8616-f5831513c43d" />

Удаление (Delete) ресурса (DELETE /api/books/{book_id})
<img width="1769" height="808" alt="image" src="https://github.com/user-attachments/assets/4d096b6b-54f1-4afd-85b2-443a6367b38b" />


Изучение OpenAPI спецификации (Задание 2.8)
<img width="1749" height="964" alt="image" src="https://github.com/user-attachments/assets/43d61e13-fda5-440c-b424-6a2c48b1c6b0" />

Расширение API (Задание 2.9)
заменить существующую функцию get_books в вашем файле main.py на новую версию, которая принимает параметры запроса (author, year_from, year_to) и применяет логику фильтрации к вашему временному хранилищу books_db
<img width="1793" height="894" alt="image" src="https://github.com/user-attachments/assets/576061e6-ac2c-49e2-b18e-ae26af221115" />


Тестирование:
• GET /api/books?author=толстой - должны вернуться книги Льва Толстого
<img width="1774" height="741" alt="image" src="https://github.com/user-attachments/assets/85146eb4-724c-4702-b63c-e7f89ba494e7" />

• GET /api/books?year_from=1860&year_to=1870 - книги, изданные в 1860-1870 годах
<img width="1762" height="871" alt="image" src="https://github.com/user-attachments/assets/8456377d-2912-42f4-abfb-4b9eaf496941" />

2.9.2. Добавление пагинации
Новые параметры пагинации будут добавлены в сигнатуру функции с значениями по умолчанию (skip=0, limit=10). Логика среза списка (filtered_books[skip:skip + limit]) будет применена после выполнения всей фильтрации.

<img width="1617" height="900" alt="image" src="https://github.com/user-attachments/assets/93d45358-ef85-46b4-9757-845034f29d40" />

GET /api/books?skip=1&limit=2
<img width="1597" height="767" alt="image" src="https://github.com/user-attachments/assets/04e4c70c-b8b4-4049-a5bd-c540a6a6e3f8" />

GET /api/books?author=толстой&limit=1 вернет только первую книгу Толстого
<img width="1590" height="650" alt="image" src="https://github.com/user-attachments/assets/00416fc3-4653-47d0-bdac-c614cf82f5b4" />

2.9.3. Добавление статистики
<img width="1722" height="723" alt="image" src="https://github.com/user-attachments/assets/d132d339-c27c-4e44-9e23-d222777e19f7" />

GET /api/books/stats
<img width="1589" height="684" alt="image" src="https://github.com/user-attachments/assets/05ab15e1-9da6-49ca-9e7a-7a301f00189f" />

2.10. Задание 5: Добавление базы данных SQLite
Цель: Заменить временное хранилище данных в памяти на постоянную базу данных SQLite для обеспечения сохранения данных между сеансами работы API.

Реализация:

Настройка базы данных: Создан файл database.py для конфигурации подключения к SQLite, определения ORM-модели BookDB с использованием SQLAlchemy и автоматического создания таблицы books.

Инициализация данных: Обеспечено автоматическое заполнение базы данных начальными книгами при первом запуске.

Интеграция с FastAPI: Все эндпоинты в main.py (CRUD, фильтрация, статистика) модифицированы для использования механизма внедрения зависимостей (Depends(get_db)). Это позволяет получать сессию SQLAlchemy для каждого запроса, выполняя необходимые операции с данными (запросы, добавление, обновление, удаление) и гарантируя автоматическое закрытие соединения.

Результат: API переведено на промышленное хранение данных, что обеспечивает полноценную работу с persistent data (постоянными данными).

2.11. Задание 6: Добавление аутентификации

GET /api/books должен работать без ключа, возвращая код 200.
<img width="1585" height="804" alt="image" src="https://github.com/user-attachments/assets/db972f01-8e6a-4510-ae93-442d510e195a" />

POST /api/books без ключа (403 Forbidden)
<img width="1593" height="685" alt="image" src="https://github.com/user-attachments/assets/f7e54d77-e44d-4d03-9ebb-1b7ce3701a6a" />

POST /api/books с ключом
<img width="725" height="342" alt="image" src="https://github.com/user-attachments/assets/c9655d59-c48e-4dfd-b157-3939c202317a" />
<img width="1588" height="723" alt="image" src="https://github.com/user-attachments/assets/cd0fdbf7-20ba-41aa-af00-35d547dedeb8" />


